

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Representation Learner Usage &mdash; Representations for Imitation Learning 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Design Principles" href="rep_learner_design.html" />
    <link rel="prev" title="Dataset Creation &amp; Environment Specification" href="data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Representations for Imitation Learning
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">Dataset Creation &amp; Environment Specification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Representation Learner Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#training-a-pre-defined-representation-learner">Training a Pre-Defined Representation Learner</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-a-new-representation-learner">Defining a New Representation Learner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#existing-pre-defined-representation-learners">Existing Pre-Defined Representation Learners</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rep_learner_design.html">Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpret.html">Interpreting Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="il_representations.html">il_representations package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Representations for Imitation Learning</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Representation Learner Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/representation_learner_usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="representation-learner-usage">
<span id="rep-learner-usage"></span><h1>Representation Learner Usage<a class="headerlink" href="#representation-learner-usage" title="Permalink to this headline">¶</a></h1>
<p>All implementations of representation learning algorithms in this codebase are built around one central abstraction,
which is, perhaps not surprisingly, a class called <cite>RepresentationLearner</cite>. This class defines the
general framework by which components of representation learner training happen. Different variants of
RepL algorithms are designed by creating a learner which takes in and runs different implementations of those component steps.</p>
<div class="section" id="training-a-pre-defined-representation-learner">
<span id="pre-defined"></span><h2>Training a Pre-Defined Representation Learner<a class="headerlink" href="#training-a-pre-defined-representation-learner" title="Permalink to this headline">¶</a></h2>
<p>For the sake of our experimentation, we have defined a number of existing, commonly used algorithms, and have made
them available to import and use directly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">il_representations.algos</span> <span class="kn">import</span> <span class="n">SimCLR</span><span class="p">,</span> <span class="n">NoAugmentation</span>
<span class="kn">from</span> <span class="nn">il_representations.utils</span> <span class="kn">import</span> <span class="n">convert_to_simple_webdataset</span><span class="p">,</span> <span class="n">load_simple_webdataset</span>

<span class="c1"># This step converts a Pytorch dataset of the form [{&#39;obs&#39;: &lt;image&gt;}...] into a Webdataset</span>
<span class="c1"># that can stream from disk. This step only needs to be performed once</span>
<span class="n">full_wds_url</span> <span class="o">=</span> <span class="n">convert_to_simple_webdataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">pytorch_dataset</span><span class="p">,</span>
                                            <span class="n">file_out_path</span><span class="o">=</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span>
                                            <span class="n">file_out_name</span><span class="o">=</span><span class="s2">&quot;my_dataset&quot;</span><span class="p">)</span>

<span class="n">wds</span> <span class="o">=</span> <span class="n">load_simple_webdataset</span><span class="p">(</span><span class="n">full_wds_url</span><span class="p">)</span>

<span class="c1"># For this example, we&#39;re imagining a (3, 64, 64) image size</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">algos</span><span class="o">.</span><span class="n">SimCLR</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">observation_space</span><span class="o">=</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
                                                 <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                 <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">action_space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">augmenter</span><span class="o">=</span><span class="n">NoAugmentation</span><span class="p">)</span>
<span class="c1"># This trains for a single epoch of 10 batches, calculating logging</span>
<span class="c1"># information and logging it every step. This is likely substantially</span>
<span class="c1"># more logging than you&#39;d want for a typical training use case</span>
<span class="n">algo</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">datasets</span><span class="o">=</span><span class="p">[</span><span class="n">wds</span><span class="p">],</span> <span class="n">batches_per_epoch</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">log_dir</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="n">log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">calc_log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-a-new-representation-learner">
<span id="define-new"></span><h2>Defining a New Representation Learner<a class="headerlink" href="#defining-a-new-representation-learner" title="Permalink to this headline">¶</a></h2>
<p>Let’s use the SimCLR example from above to walk through how you might create an algorithm that differs from it in some way.
This is the code used in <cite>algos/__init__.py</cite> to define the SimCLR algorithm class, with some additional
explanatory documentation added in for clarity’s sake. This explanation will assume you have some familiarity with the
conceptual breakdown used in this codebase; if you’re unsure about that, you can read more <a class="reference internal" href="rep_learner_design.html#rep-learner-design"><span class="std std-ref">here!</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimCLR</span><span class="p">(</span><span class="n">RepresentationLearner</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Implementation of SimCLR: A Simple Framework for</span>
<span class="sd">Contrastive Learning of Visual Representations</span>
<span class="sd">https://arxiv.org/abs/2002.05709</span>

<span class="sd">This method works by using a contrastive loss to push together representations</span>
<span class="sd">of two differently-augmented versions of the same image. In particular, it</span>
<span class="sd">uses a symmetric contrastive loss, which compares the (target, context)</span>
<span class="sd">similarity against similarity of context with all other targets, and also</span>
<span class="sd">similarity of target with all other contexts.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># This is where we specify the RepresentationLearner arguments</span>
    <span class="c1"># that are integral to the algorithm definition of SimCLR</span>

    <span class="n">algo_hardcoded_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="c1"># We use our BaseEncoder to map from image to representation</span>
                                 <span class="c1"># The output of `encoder` is what we use for transfer</span>
                                 <span class="n">encoder</span><span class="o">=</span><span class="n">BaseEncoder</span><span class="p">,</span>
                                 <span class="c1"># A MLP projection head, symmetric between context and target</span>
                                 <span class="c1"># The output of `decoder` is passed to the loss function</span>
                                 <span class="n">decoder</span><span class="o">=</span><span class="n">SymmetricProjectionHead</span><span class="p">,</span>
                                 <span class="c1"># A contrastive loss where we try to predict</span>
                                 <span class="c1"># target given context and also context given target</span>
                                 <span class="n">loss_calculator</span><span class="o">=</span><span class="n">SymmetricContrastiveLoss</span><span class="p">,</span>
                                 <span class="c1"># Augment both context and target before encoder</span>
                                 <span class="n">augmenter</span><span class="o">=</span><span class="n">AugmentContextAndTarget</span><span class="p">,</span>
                                 <span class="c1"># For SimCLR, the target and context are different</span>
                                 <span class="c1"># augmentations of the same, &quot;Identity&quot; frame</span>
                                 <span class="n">target_pair_constructor</span><span class="o">=</span><span class="n">IdentityPairConstructor</span><span class="p">,</span>
                                 <span class="c1"># Since we&#39;re not using momentum here, the encoder</span>
                                 <span class="c1"># batch is the same as the one used in the loss</span>
                                 <span class="n">batch_extender</span><span class="o">=</span><span class="n">IdentityBatchExtender</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">validate_and_update_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">algo_hardcoded_kwargs</span><span class="o">=</span><span class="n">algo_hardcoded_kwargs</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="existing-pre-defined-representation-learners">
<h3>Existing Pre-Defined Representation Learners<a class="headerlink" href="#existing-pre-defined-representation-learners" title="Permalink to this headline">¶</a></h3>
<p>You can find a list of existing algorithms at: <code class="xref py py-mod docutils literal notranslate"><span class="pre">il_representations.algos</span></code></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="rep_learner_design.html" class="btn btn-neutral float-right" title="Design Principles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="data.html" class="btn btn-neutral float-left" title="Dataset Creation &amp; Environment Specification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Center for Human-Compatible AI.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>